# Supply Chain Network Design: 理论体系与模型体系
## 面向OMP实施顾问的深度业务技术指南

---

## 目录

1. [概念框架](#概念框架)
2. [基础模型](#基础模型)
3. [模型族系演进](#模型族系演进)
4. [多维度扩展](#多维度扩展)
5. [约束系统](#约束系统)
6. [目标函数权衡](#目标函数权衡)
7. [求解方法论](#求解方法论)
8. [OMP实施中的应用](#omp实施中的应用)
9. [面试准备](#面试准备)

---

## 概念框架

### Supply Chain Network Design 的本质

Supply Chain Network Design 回答一个核心战略问题：

$$\text{如何设计和配置整个供应链网络，以最小化成本同时满足服务承诺？}$$

**关键维度：**
- **谁是网络中的参与者？** (供应商、工厂、仓库、配送中心、客户)
- **产品如何在他们之间流动？** (采购、制造、存储、运输)
- **每个环节的约束是什么？** (产能、能力、时间、质量)
- **总体成本如何权衡？** (固定成本、变动成本、库存成本)

### Network Design 的问题分类

```
按规划对象分类：
├─ 单层次设施位置(Single-echelon Facility Location)
│  └─ 仓库选址、零售门店选址
│
├─ 两层次网络(Two-echelon Network)
│  └─ 供应商-工厂 或 工厂-仓库
│
├─ 多层次网络(Multi-echelon Network) ⭐
│  └─ 供应商→工厂→仓库→客户的完整链条
│
└─ 动态网络(Dynamic Network)
   └─ 考虑多个时期的产能投资和产品生命周期
```

---

## 基础模型

### 模型 1: 无容量限制设施位置问题 (UFLP)

#### 问题陈述

给定一组候选设施位置和一组需求点，决定：
- 在哪些位置开放设施
- 每个需求点由哪个设施供应
- 最小化总成本（固定成本 + 运输成本）

#### 数学表述

**参数定义：**
- $I$ = 需求点集合，$|I| = m$
- $J$ = 候选设施位置集合，$|J| = n$
- $d_i$ = 需求点 $i$ 的需求量 (单位：件/周期)
- $f_j$ = 设施 $j$ 的年固定成本 (单位：元/年)
- $c_{ij}$ = 从设施 $j$ 向需求点 $i$ 供应的单位成本 (单位：元/件)

**决策变量：**
- $y_j \in \{0,1\}$ = 设施 $j$ 是否开放 (1=开放, 0=关闭)
- $x_{ij} \geq 0$ = 从设施 $j$ 向需求点 $i$ 的供应量

**目标函数：**
$$\min Z = \sum_{j \in J} f_j y_j + \sum_{i \in I} \sum_{j \in J} c_{ij} x_{ij}$$

**约束条件：**

1. 需求满足约束
$$\sum_{j \in J} x_{ij} = d_i, \quad \forall i \in I$$
   - 解释：每个需求点的需求必须被完全满足

2. 设施开放约束 (Big-M约束)
$$x_{ij} \leq M \cdot y_j, \quad \forall i \in I, j \in J$$
   - 其中 $M = \sum_{i \in I} d_i$ (充分大常数)
   - 解释：只有当设施开放时，才能有流向这个设施

3. 非负约束
$$x_{ij} \geq 0, \quad y_j \in \{0,1\}$$

#### 问题特征

| 特征 | 值 |
|------|-----|
| 问题类型 | 0-1混合整数规划 (MIP) |
| 复杂性 | NP-Hard |
| 决策变量数 | $O(n + mn)$ |
| 约束数 | $O(m + mn)$ |
| 精确求解范围 | $n < 100$ 通常可行 |
| 典型求解时间 | 秒到分钟级 |
| 解的质量 | 最优解 |

#### 业务含义

| 成本组件 | 含义 | 决策影响 |
|---------|------|---------|
| 固定成本项 $\sum f_j y_j$ | 设施的维护、人力、租赁等 | 开放更多设施 → 固定成本↑ |
| 运输成本项 $\sum \sum c_{ij} x_{ij}$ | 配送、运输成本 | 开放更少设施 → 运输距离↑ |

**核心权衡：**
$$\text{更多设施} \Leftrightarrow \begin{cases} \text{固定成本} \uparrow \\ \text{运输成本} \downarrow \\ \text{服务} \uparrow \end{cases}$$

---

### 模型 2: 容量受限设施位置问题 (CFLP)

#### 问题陈述

在UFLP的基础上，加入设施产能约束，使问题更贴近实际。

#### 数学表述

**额外参数：**
- $\text{Cap}_j$ = 设施 $j$ 的最大产能 (单位：件/周期)

**额外约束：**
$$\sum_{i \in I} x_{ij} \leq \text{Cap}_j \cdot y_j, \quad \forall j \in J$$

- 解释：从设施 $j$ 流出的总量不能超过其产能上限

**其他同UFLP：**
$$\min Z = \sum_{j \in J} f_j y_j + \sum_{i \in I} \sum_{j \in J} c_{ij} x_{ij}$$

$$\text{s.t.} \quad \sum_{j \in J} x_{ij} = d_i, \quad \forall i$$

#### 与UFLP的区别

| 维度 | UFLP | CFLP |
|------|------|------|
| 产能约束 | 无 | 有 |
| 现实性 | 低 | 高 |
| 求解难度 | 中 | 高 |
| 约束数 | $O(m)$ | $O(m+n)$ |
| 精确求解范围 | $n < 100$ | $n < 50$ |
| LP松弛界的紧性 | 松 | 紧 |

**为什么CFLP比UFLP更难？**
- 额外的产能约束增加了问题的耦合性
- 但同时，这些约束也提供了更强的剪切条件
- 分支定界树可能更小，但每个节点的LP求解更复杂

#### 业务含义补充

CFLP更现实，因为：
- 设施不是无限产能的
- 不是简单地选择"开"或"关"
- 而是要在产能和需求之间找到平衡
- 某些需求可能无法被满足（如果总产能不足）

---

## 模型族系演进

### 演进路径概览

```
UFLP (无容量)
    ↓ (添加产能)
CFLP (有容量)
    ↓ (扩展到多层)
Multi-echelon Network Design (MEND)
    ↓ (加入库存)
Stochastic Multi-echelon Network Design
    ↓ (加入时间维度)
Dynamic Network Design
```

---

### 模型 3: 两层网络设计 (Two-Echelon Network Design)

#### 问题陈述

设计工厂-仓库两层网络，决定：
- 工厂的位置和产能
- 仓库的位置和容量
- 工厂到仓库的流向
- 仓库到客户的流向

#### 参数定义

**两层节点：**
- $J$ = 候选工厂位置集合
- $K$ = 候选仓库位置集合
- $I$ = 需求点集合

**成本参数：**
- $f_j$ = 工厂 $j$ 的年固定成本
- $g_k$ = 仓库 $k$ 的年固定成本
- $c_{jk}$ = 从工厂 $j$ 到仓库 $k$ 的单位运输成本
- $c_{ki}$ = 从仓库 $k$ 到客户 $i$ 的单位运输成本
- $h_k$ = 仓库 $k$ 的库存持有成本 (单位：元/(件·年))

**产能和需求：**
- $\text{Cap}_j$ = 工厂 $j$ 的产能
- $\text{Cap}_k$ = 仓库 $k$ 的容量
- $d_i$ = 客户 $i$ 的需求

#### 数学表述

**决策变量：**
- $y_j \in \{0,1\}$ = 工厂 $j$ 是否开放
- $z_k \in \{0,1\}$ = 仓库 $k$ 是否开放
- $x_{jk} \geq 0$ = 从工厂 $j$ 到仓库 $k$ 的流量
- $x_{ki} \geq 0$ = 从仓库 $k$ 到客户 $i$ 的流量
- $I_k \geq 0$ = 仓库 $k$ 的平均库存水平

**目标函数：**
$$\min Z = \sum_{j} f_j y_j + \sum_{k} g_k z_k + \sum_{j} \sum_{k} c_{jk} x_{jk} + \sum_{k} \sum_{i} c_{ki} x_{ki} + \sum_{k} h_k I_k$$

分项含义：
- 第1项：工厂固定成本
- 第2项：仓库固定成本
- 第3项：厂-库运输成本
- 第4项：库-客户运输成本
- 第5项：库存持有成本 (关键新增项)

**约束条件：**

1. 工厂产能约束
$$\sum_{k} x_{jk} \leq \text{Cap}_j \cdot y_j, \quad \forall j$$

2. 仓库容量约束
$$\sum_{k} x_{jk} \leq \text{Cap}_k \cdot z_k, \quad \forall k$$

3. 仓库流量平衡 (流入=流出)
$$\sum_{j} x_{jk} = \sum_{i} x_{ki}, \quad \forall k$$
   - 解释：仓库是中转站，不能存留产品

4. 客户需求满足
$$\sum_{k} x_{ki} = d_i, \quad \forall i$$

5. 库存计算（简化）
$$I_k = \frac{1}{2} \sum_{j} x_{jk} \cdot L_k$$
   - 其中 $L_k$ = 仓库的周期库存周期
   - 或者假设 $I_k = \alpha \sum_{j} x_{jk}$，其中 $\alpha$ 是库存系数

#### 与UFLP/CFLP的关键差异

| 特性 | UFLP/CFLP | 两层MEND |
|------|-----------|---------|
| 网络层数 | 1-2 | 2 |
| 库存考虑 | 无 | 有 (库存持有成本) |
| 中间设施 | 无 | 有 (仓库作为中转) |
| 变量数 | $O(mn)$ | $O(mn + nk + mk)$ |
| 约束数 | $O(m+n)$ | $O(m+n+k)$ |
| 流动平衡 | 单向 | 双向(流入=流出) |

---

### 模型 4: 多层级网络设计 (Multi-Echelon Network Design, MEND)

#### 问题陈述

设计完整的供应链网络，包括供应商→工厂→仓库→客户的多层流动。

#### 参数定义

**网络层级定义：**
- $L = 1, 2, 3, 4$ = 供应商、工厂、仓库、客户
- $N_\ell$ = 第 $\ell$ 层的节点集合

**成本参数：**
- $f_{\ell,j}$ = 第 $\ell$ 层设施 $j$ 的年固定成本
- $c_{\ell,\ell+1,ij}$ = 从第 $\ell$ 层节点 $i$ 到第 $\ell+1$ 层节点 $j$ 的单位成本
- $h_{\ell,j}$ = 第 $\ell$ 层节点 $j$ 的库存持有成本

**产能和需求：**
- $\text{Cap}_{\ell,j}$ = 第 $\ell$ 层节点 $j$ 的产能/容量
- $d_i$ = 最终客户 $i$ 的需求
- $L_{ij}$ = 从节点 $i$ 到节点 $j$ 的交付周期

#### 数学表述 (简化版)

**决策变量：**
- $y_{\ell,j} \in \{0,1\}$ = 第 $\ell$ 层节点 $j$ 是否开放
- $x_{\ell,\ell+1,ij}$ = 从第 $\ell$ 层节点 $i$ 到第 $\ell+1$ 层节点 $j$ 的流量
- $I_{\ell,j}$ = 第 $\ell$ 层节点 $j$ 的库存水平
- $SS_{\ell,j}$ = 第 $\ell$ 层节点 $j$ 的安全库存

**目标函数：**
$$\min Z = \sum_{\ell} \sum_{j} f_{\ell,j} y_{\ell,j} + \sum_{\ell < L} \sum_{i,j} c_{\ell,\ell+1,ij} x_{\ell,\ell+1,ij} + \sum_{\ell} \sum_{j} h_{\ell,j} I_{\ell,j}$$

分项含义：
- 第1项：各层设施的固定成本
- 第2项：各层间的运输成本
- 第3项：各层的库存持有成本

**约束条件：**

1. **产能约束** (多层)
$$\sum_j x_{\ell,\ell+1,ij} \leq \text{Cap}_{\ell,j} \cdot y_{\ell,j}, \quad \forall \ell, j$$

2. **流量平衡约束** (关键约束)

对于中间层 $\ell$ ($1 < \ell < 4$) 的每个节点 $j$：
$$\sum_i x_{\ell-1,\ell,ij} = \sum_k x_{\ell,\ell+1,jk} + I_{\ell,j} - I_{\ell,j}^{prev}$$

   - 解释：流入 = 流出 + 库存增加
   - 这确保了物料守恒

3. **需求满足约束**
$$\sum_j x_{L-1,L,jk} = d_k, \quad \forall k \in N_L$$

   - 解释：所有需求必须被满足

4. **库存约束**
$$I_{\ell,j} \geq SS_{\ell,j}, \quad \forall \ell, j$$

   - 解释：实际库存不能低于安全库存

5. **安全库存定义**
$$SS_{\ell,j} = z \cdot \sigma_{\ell,j} \cdot \sqrt{L_{\ell,j}}$$

   - $z$ = 安全因子 (由目标服务水平决定)
   - $\sigma_{\ell,j}$ = 该节点处的需求标准差
   - $L_{\ell,j}$ = 交付周期

6. **供应链连通约束** (关键)

若第 $\ell$ 层节点 $i$ 关闭，则不能有流向该节点的产品：
$$x_{\ell-1,\ell,ki} = 0 \text{ if } y_{\ell,i} = 0, \quad \forall k, i$$

   - 以Big-M约束表示：
$$x_{\ell-1,\ell,ki} \leq M \cdot y_{\ell,i}$$

#### MEND的关键特征

| 特性 | 值 |
|------|-----|
| 网络层数 | 3-5层 |
| 决策变量数 | $O(L \cdot n^2)$ = 百万级 |
| 约束数 | $O(L \cdot n^2)$ = 百万级 |
| 非线性项 | 有 (库存与流量相关) |
| 精确求解 | 不可行 (>100节点) |
| 求解方法 | 启发式或分解算法 |
| 求解时间 | 分钟到小时级 |

---

## 多维度扩展

### 扩展 1: 多产品 (Multi-Product)

#### 问题描述

实际中往往不是单一产品，而是多种SKU，可能共用工厂产线。

#### 模型修改

**参数扩展：**
- $P$ = 产品集合
- $d_{ip}$ = 客户 $i$ 对产品 $p$ 的需求
- $c_{ijp}$ = 从设施 $j$ 向需求点 $i$ 供应产品 $p$ 的单位成本
- $r_{jp}$ = 设施 $j$ 生产产品 $p$ 的单位成本

**决策变量修改：**
- $x_{ijp}$ = 从设施 $j$ 向需求点 $i$ 供应产品 $p$ 的量
- $y_{jp}$ = 设施 $j$ 是否生产产品 $p$ (可选，用于考虑转产成本)

**目标函数修改：**
$$\min Z = \sum_j f_j y_j + \sum_j \sum_p s_{jp} y_{jp} + \sum_i \sum_j \sum_p c_{ijp} x_{ijp} + \sum_j \sum_p r_{jp} \sum_i x_{ijp}$$

其中 $s_{jp}$ 是产品 $p$ 在工厂 $j$ 的转产或设置成本。

**约束扩展：**

产能约束变为产品层级：
$$\sum_i \sum_p \alpha_{jp} x_{ijp} \leq \text{Cap}_j \cdot y_j$$

其中 $\alpha_{jp}$ 是产品 $p$ 的单位占用产能系数 (因为不同产品可能耗用不同的产能)。

#### 业务含义

- 某些产品可能只适合在特定工厂生产
- 产品组合的优化变为重要决策
- 产能共享导致复杂的权衡

---

### 扩展 2: 多个供应源 (Multiple Sourcing)

#### 问题描述

每个需求点可以从多个设施获得供应，而不是只能选择一个。

#### 模型修改

**原始UFLP的隐性假设：** 每个需求点从最便宜的设施获得供应

**新的建模方式：** 允许分散采购

实际上，基础UFLP本身就允许这个：
$$\sum_{j \in J} x_{ij} = d_i$$

这允许多个 $j$ 同时向需求点 $i$ 供应。

**但引入显式约束来限制供应源数量：**

$$\sum_{j} y_{ij} \leq K_i, \quad \forall i$$

其中 $y_{ij} \in \{0,1\}$ 表示设施 $j$ 是否向需求点 $i$ 供应。

结合Big-M约束：
$$x_{ij} \leq M \cdot y_{ij}$$

#### 业务含义

- 降低供应风险 (不依赖单一工厂)
- 但增加了流向复杂性
- 可能导致更高的成本，但更高的可靠性

---

### 扩展 3: 区域覆盖约束 (Coverage Constraints)

#### 问题描述

某些需求点（如偏远地区）只能从特定区域的设施获得供应。

#### 模型修改

定义 $J_i$ 为可以服务需求点 $i$ 的设施集合（基于地理距离、交付时间等）。

修改需求满足约束：
$$\sum_{j \in J_i} x_{ij} = d_i, \quad \forall i$$

而不是：
$$\sum_{j \in J} x_{ij} = d_i$$

#### 业务含义

- 确保服务可达性
- 避免过长的交付时间
- 在某些市场中法规要求（如出口）

---

### 扩展 4: 交付时间约束 (Lead Time Constraints)

#### 问题描述

从设施到客户的交付时间必须不超过承诺的交付时间。

#### 模型修改

定义 $T_{ij}$ = 从设施 $j$ 到需求点 $i$ 的交付时间，$T_{\max,i}$ = 承诺的最大交付时间。

添加约束：
$$T_{ij} \leq T_{\max,i} \quad \text{或} \quad \sum_{j: T_{ij} > T_{\max,i}} x_{ij} = 0$$

第二种表述更严格，禁止从超时的设施供应。

或者，加入交付时间的成本惩罚：
$$\min Z = \ldots + \sum_i \sum_j \pi_i \cdot \max(0, T_{ij} - T_{\max,i}) \cdot x_{ij}$$

#### 业务含义

- 服务水平的硬约束 (某些客户要求5日内交付)
- 或软约束 (超时有惩罚但可能)
- 这往往迫使开设更多的仓库

---

### 扩展 5: 产品-设施兼容性 (Product-Facility Compatibility)

#### 问题描述

某些产品由于工艺或许可限制，只能在特定工厂生产。

#### 模型修改

定义 $J_p$ = 可以生产产品 $p$ 的工厂集合。

修改生产约束：
$$\sum_i x_{ijp} \leq \text{Cap}_{jp} \cdot y_{jp} \quad \text{if } j \in J_p$$
$$y_{jp} = 0 \quad \text{if } j \notin J_p$$

#### 业务含义

- 许可限制 (某些产品有国家/行业认证)
- 工艺限制 (特定产品需要特定设备)
- 常见于制药、食品、电子制造

---

## 约束系统

### 约束分类与相互关系

```
Network Design 约束系统

├── 物理约束
│  ├─ 产能约束 (Capacity Constraints)
│  ├─ 流量非负约束 (Non-negativity)
│  └─ 二进制约束 (Binary Constraints for Facility Open)
│
├── 供应链约束
│  ├─ 流量平衡约束 (Flow Conservation)
│  ├─ 供应链连通约束 (Supply Chain Connectivity)
│  ├─ 需求满足约束 (Demand Satisfaction)
│  └─ 库存约束 (Inventory Constraints)
│
├── 服务约束
│  ├─ 交付时间约束 (Lead Time Constraints)
│  ├─ 服务水平约束 (Service Level Constraints)
│  └─ 覆盖约束 (Coverage Constraints)
│
└── 可行性约束
   ├─ 不可行集检测 (Infeasibility Detection)
   └─ 冗余约束检测 (Redundancy Detection)
```

### 约束 1: 产能约束 (Capacity Constraint)

**标准形式：**
$$\sum_{j \in J} x_{ij} \leq \text{Cap}_i, \quad \forall i$$

**变体：**
- 带开放条件：$\sum_j x_{ij} \leq \text{Cap}_i \cdot y_i$
- 带可扩展产能：$\sum_j x_{ij} \leq \text{Cap}_i^0 + \text{Cap}_i^{\text{add}} \cdot z_i$
  其中 $z_i$ 表示是否扩建，$\text{Cap}_i^{\text{add}}$ 是扩建的额外产能

**业务含义：**
- 硬约束：设施无法超过物理产能
- 成本影响：产能利用率不足 → 固定成本摊薄增加

---

### 约束 2: 流量平衡约束 (Flow Conservation)

**标准形式 (两层情况)：**
$$\sum_i x_{ij} = \sum_k x_{jk}, \quad \forall j$$

**含义：** 中间节点的流入量等于流出量

**多层推广：**

对于中间层 $\ell$：
$$\sum_i x_{\ell-1,\ell,ij} = \sum_k x_{\ell,\ell+1,jk} + \Delta I_{\ell,j}$$

其中 $\Delta I_{\ell,j}$ 是库存的变化量。

**业务含义：**
- 确保物料守恒
- 中间仓库不能凭空产生或消失产品
- 是多层网络的基础约束

---

### 约束 3: 供应链连通约束 (Supply Chain Connectivity)

**关键概念：** 如果一个节点关闭，则不能有产品流向或流出该节点。

**Big-M形式：**
$$x_{ij} \leq M \cdot y_i, \quad \forall i, j$$

**业务含义：**
- 确保供应链的逻辑完整性
- 若工厂关闭，不能从它供应
- 这是最容易被遗漏的约束，也是造成模型infeasibility的常见原因

---

### 约束 4: 需求满足约束 (Demand Satisfaction)

**标准形式：**
$$\sum_j x_{ij} = d_i, \quad \forall i$$

**变体：**
- 允许部分缺货：$\sum_j x_{ij} \geq (1-\alpha) d_i$，其中 $\alpha$ 是允许的缺货率
- 动态需求：$d_{it}$ 表示时期 $t$ 的需求

**业务含义：**
- 硬约束或软约束取决于业务
- 某些产品可能允许缺货 (电子产品)
- 某些产品不允许 (药品、食品)

---

### 约束 5: 库存约束 (Inventory Constraints)

**安全库存下界：**
$$I_j \geq SS_j = z \cdot \sigma_j \cdot \sqrt{L_j}, \quad \forall j$$

**库存容量上界：**
$$I_j \leq \text{Cap}_{I,j}, \quad \forall j$$

**库存周期计算：**
$$I_j = \frac{1}{2} \cdot \text{(周期需求)} + SS_j$$

**业务含义：**
- 库存成本是MEND的关键成本
- 安全库存是对需求不确定性的保护
- 目标：在给定服务水平下，最小化库存

---

### 约束 6: 交付时间约束 (Lead Time Constraints)

**硬约束形式：**
$$\sum_{j: T_{ij} \leq T_{\max}} x_{ij} = d_i, \quad \forall i$$

其中只考虑满足交付时间的设施。

**软约束形式 (加入目标函数)：**
$$Z_{\text{penalty}} = \sum_i \sum_j \pi_i \cdot \mathbb{1}(T_{ij} > T_{\max}) \cdot x_{ij}$$

**业务含义：**
- 服务承诺的实现
- 往往与成本冲突 (快速服务需要更多仓库)
- OMP中的关键约束

---

## 目标函数权衡

### 多目标优化视角

Network Design的本质是**多目标问题**，但通常被转化为单目标的加权和。

#### 目标函数的完整形式

$$\min Z = \alpha_1 Z_{\text{cost}} + \alpha_2 Z_{\text{service}} + \alpha_3 Z_{\text{risk}}$$

其中权重 $\alpha_i$ 由企业的战略决定。

### 目标 1: 成本最小化 (Cost Minimization)

$$Z_{\text{cost}} = \underbrace{\sum_j f_j y_j}_{\text{固定成本}} + \underbrace{\sum_{ij} c_{ij} x_{ij}}_{\text{运输成本}} + \underbrace{\sum_j h_j I_j}_{\text{库存成本}}$$

**成本分解：**

| 成本项 | 占比范围 | 优化空间 |
|--------|---------|---------|
| 固定成本 (设施) | 20-40% | 中等 (网络结构优化) |
| 运输成本 | 15-25% | 中等 (流向优化) |
| 库存成本 | 25-40% | 大 (库存政策优化) |
| 其他 (采购、加工等) | 10-20% | 取决于行业 |

**不同行业的成本结构：**

电子制造 (如vivo):
- 库存成本占比高 (40%+，因为器件贬值)
- 固定成本占比中等 (30%)
- 优化重点：库存优化 > 网络结构

FMCG (快消):
- 运输成本占比高 (30%+，因为量大但价值低)
- 库存成本占比中等 (20-30%)
- 优化重点：网络结构 > 运输优化

---

### 目标 2: 服务水平优化 (Service Level Optimization)

#### 服务水平的多维定义

| 维度 | 指标 | 定义 |
|------|------|------|
| 响应能力 | 交付周期 (Days) | 订单到货的天数 |
| 可靠性 | 订单完成率 (%) | 能完全满足订单的比例 |
| 灵活性 | 库存可用性 (%) | 无缺货的时间比例 |
| 准时性 | 准时交货率 (%) | 按承诺交期交货的比例 |

#### 在优化中的表现形式

**方式1：硬约束**
$$T_{ij} \leq T_{\max,i}, \quad \forall i$$
(所有流都必须满足交付时间)

**方式2：目标函数中的惩罚**
$$Z_{\text{service}} = \sum_i \sum_j \pi_i \cdot x_{ij} \cdot \mathbb{1}(T_{ij} > T_{\max})$$
(超时的流被惩罚)

**方式3：库存的安全因子调整**

给定目标完成率 $\text{SL}$，计算所需安全因子：
$$z = \Phi^{-1}(\text{SL})$$

其中 $\Phi$ 是标准正态分布函数。

- 若 SL = 95% → $z \approx 1.645$ → 库存↑
- 若 SL = 99% → $z \approx 2.326$ → 库存↑↑
- 增加1%的完成率，需要增加5-10%的库存

---

### 目标 3: 风险最小化 (Risk Minimization)

#### 风险类型

```
供应链风险分类：

├── 供应风险
│  ├─ 供应商集中风险 (单一供应源)
│  ├─ 地理集中风险 (工厂在同一地区)
│  └─ 政治/汇率风险 (国家层级)
│
├── 运营风险
│  ├─ 产能风险 (设施故障)
│  ├─ 需求风险 (预测误差)
│  └─ 库存风险 (过期、损伤)
│
└── 市场风险
   ├─ 需求波动
   ├─ 竞争风险
   └─ 法规风险
```

#### 在优化中的表现

**多供应源约束 (降低供应风险)：**
$$\text{num\_suppliers}_i = \sum_j y_{ij} \geq K, \quad \forall i$$

其中 $K$ 是最少供应源数。

**地理分散约束 (降低地理集中风险)：**
$$\sum_{j \in \text{Region}_r} y_j \leq \text{Max\_facilities}\_r, \quad \forall r$$

**库存缓冲 (应对需求不确定性)：**

通过安全库存的安全因子 $z$ 的选择。

**权衡函数：**
$$Z = Z_{\text{cost}} + \lambda \cdot Z_{\text{risk}}$$

其中 $\lambda$ 表示对风险的厌恶程度。

---

### 权衡场景分析

#### 场景类型

| 场景 | 权重设置 | 适用情况 |
|------|---------|---------|
| 成本优先 | $\alpha_1 >> \alpha_2 = \alpha_3$ | 低毛利产品 (消费品) |
| 服务优先 | $\alpha_2 >> \alpha_1 = \alpha_3$ | 高端产品 (医药、芯片) |
| 平衡 | $\alpha_1 \approx \alpha_2 > \alpha_3$ | 大多数制造业 |
| 风险规避 | $\alpha_3$ 显著 | 供应链脆弱的产品 |

#### 对优化结果的影响

**高成本权重：**
- 结果：更少的设施、更长的交付时间
- 库存：低库存
- 成本：低

**高服务权重：**
- 结果：更多的设施、更短的交付时间
- 库存：高库存
- 成本：高

**平衡权重：**
- 结果：中等数量设施
- 库存：中等
- 成本：中等

---

## 求解方法论

### 方法分类

```
Network Design 求解方法体系

├── 精确算法 (Optimal Solution)
│  ├─ 分支定界法 (Branch & Bound)
│  ├─ 分支割平面法 (Branch-and-Cut)
│  └─ 动态规划 (Dynamic Programming, 小规模)
│
├── 启发式算法 (Good Feasible Solution)
│  ├─ 构造启发式 (Constructive Heuristics)
│  │  ├─ 贪心算法 (Greedy)
│  │  └─ 节省算法 (Savings Algorithm)
│  │
│  ├─ 改进启发式 (Improvement Heuristics)
│  │  ├─ 局部搜索 (Local Search)
│  │  ├─ 禁忌搜索 (Tabu Search)
│  │  └─ 模拟退火 (Simulated Annealing)
│  │
│  └─ 群智能算法 (Swarm Intelligence)
│     ├─ 遗传算法 (Genetic Algorithm)
│     └─ 蚁群算法 (Ant Colony Optimization)
│
└── 分解方法 (Decomposition)
   ├─ 拉格朗日分解 (Lagrangian Relaxation)
   └─ Benders分解 (Benders Decomposition)
```

---

### 精确算法：分支定界法 (Branch & Bound)

#### 核心思想

通过 LP 松弛和系统的分支，逐步缩小最优解的可能范围。

#### 算法步骤

**初始化：**
1. 求解 LP 松弛问题 (去掉整数约束，放松为 $y_j \in [0,1]$)
2. 得到下界 $\text{LB} = Z_{\text{LP}}$
3. 用启发式找到一个可行的整数解，得到上界 $\text{UB}$

**迭代分支：**
1. 选择最分数的整数变量 $y_j^* = 0.6$ (既不是0也不是1)
2. 创建两个子问题：
   - 分支1：$y_j = 1$ (该设施必须开放)
   - 分支2：$y_j = 0$ (该设施必须关闭)
3. 分别求解两个子问题的 LP 松弛

**剪除 (Pruning)：**
- 若某个分支的 LP 值 $\geq \text{UB}$，则剪除该分支
- 若某个分支给出可行整数解，更新 UB

**停止准则：**
- 当 $\text{UB} \leq \text{LB} \times (1 + \epsilon)$ 时停止，其中 $\epsilon$ 是允许的最优性gap

#### 分支树示例

```
                    根节点 (LP松弛)
                    Z_LP = 1000
                    y_3 = 0.6
                    /              \
              y_3=1分支          y_3=0分支
              Z_LP=1050          Z_LP=980
              可行整数解          继续分支
              Z=1120             /          \
              更新 UB=1120      y_5=1      y_5=0
                               Z_LP=995   Z_LP=990
                               可行解     可行解
                               Z=1100     Z=1010
                               
剪除分析：
- 所有分支的 LP值都 < 1120 (当前UB)
- 所以继续探索

最终：
- 最好的整数解 = 1010
- 最优性gap = (1020-1010)/1010 = 1%
```

#### 计算复杂性

| 问题规模 | 分支树大小 | 求解时间 | 可行性 |
|---------|-----------|---------|--------|
| $n=10$ | < 100 | 0.1秒 | ✓ 可行 |
| $n=50$ | < 10,000 | 几秒 | ✓ 可行 |
| $n=100$ | < 100,000 | 数十秒 | ✓ 可行 |
| $n=200$ | > 1,000,000 | 分钟到小时 | ⚠️ 困难 |
| $n=500$ | > 10,000,000 | 无法求解 | ✗ 不可行 |

---

### 启发式算法：贪心算法 (Greedy)

#### 算法思想

逐步添加（或删除）最优的设施，直到无法改进为止。

#### 构造阶段 (从空开始)

**步骤：**

1. 初始化：$S = \emptyset$ (已开放的设施集合)
2. 计算"成本效率"：对于每个候选设施 $j$，若加入 $S$，成本增加多少？

   $$\text{Efficiency}_j = \frac{\text{新增总成本}}{\text{能满足的需求量}}$$

3. 选择效率最好的设施加入 $S$
4. 更新需求 (已被满足的从总需求中删除)
5. 重复直到所有需求被满足

**优点：**
- 计算快速 ($O(n^2)$ 或 $O(n^3)$)
- 通常得到可接受的解 (70-90% of optimal)

**缺点：**
- 可能陷入局部最优
- 对初始解敏感

#### 删除阶段 (从全开始)

反向操作：从所有设施开放开始，逐步尝试关闭最不经济的设施。

$$\text{benefit\_of\_closing}_j = f_j - \text{(由于关闭增加的运输和库存成本)}$$

---

### 启发式算法：禁忌搜索 (Tabu Search)

#### 算法思想

在搜索过程中维护一个"禁忌表"，记录最近访问过的解，防止重复和循环。

#### 核心组件

**邻域定义：**
一个邻域解是通过以下操作得到的：
- 打开一个当前关闭的设施
- 关闭一个当前开放的设施
- 重新分配某个需求点的供应源

**禁忌表：**
记录最近访问的K个解 (或属性)，在接下来的迭代中禁止进入这些解。

**特赦准则 (Aspiration Criterion)：**
即使某个解在禁忌表中，如果它优于历史最优解，仍然允许进入。

#### 算法流程

```
初始化：选择初始解 S_0
最佳已知解 S_best = S_0
禁忌表 TL = []

迭代 t = 1, 2, ..., T_max:
  生成 S_0 的邻域解集合 N(S_0)
  
  对每个邻域解 S' in N(S_0):
    if S' in TL and Z(S') < Z(S_best):
        // 特赦：尽管在禁忌表中，但优于最优
        接受 S'
    elif S' not in TL:
        接受最好的非禁忌解 S'
  
  S_0 = S'
  更新 S_best (如果 Z(S') < Z(S_best))
  
  TL.add(S')  // 将 S' 加入禁忌表
  if len(TL) > K:
      TL.remove_oldest()  // 移除最旧的禁忌

输出 S_best
```

#### 优缺点

**优点：**
- 能跳出局部最优 (通过允许恶化的解)
- 结果质量通常很好 (85-95%)
- 参数调整空间大

**缺点：**
- 需要精心调整参数 (K, T_max, 邻域大小)
- 编程复杂性高
- 计算时间不可控

---

## OMP实施中的应用

### OMP的优化引擎

OMP内置的求解器通常是商业化的优化引擎（类似Gurobi或CPLEX），支持：
- 分支定界精确求解 (对于中等规模问题)
- 启发式求解 (对于大规模问题)
- 自适应选择 (根据问题规模和时间预算)

### 用户配置点

OMP中，用户不需要编程，而是通过配置参数来"建模"：

#### 1. 设施参数 (Facility Configuration)

```
[设施参数表]
设施ID | 设施名 | 类型 | 固定成本 | 产能 | 开放状态
F01    | 深圳厂| 工厂 | 500万  | 1000K | 已开放
F02    | 成都厂| 工厂 | 300万  | 800K  | 已开放
F03    | 西安厂| 工厂 | 200万  | 500K  | 可选
W01    | 华东仓| 仓库 | 200万  | 5000K | 已开放
W02    | 华南仓| 仓库 | 150万  | 4000K | 已开放
```

#### 2. 需求参数 (Demand Configuration)

```
[需求参数表]
客户ID | 客户名 | 需求量 | 目标交付时间 | 完成率要求
C001   | 北京区 | 200K  | 3天        | 95%
C002   | 上海区 | 300K  | 2天        | 98%
C003   | 广州区 | 150K  | 3天        | 95%
```

#### 3. 流动参数 (Flow Cost Configuration)

```
[运输成本矩阵]
从\到  | C001 | C002 | C003 | C004 | ...
F01    | 50   | 100  | 200  | 300  |
F02    | 200  | 150  | 100  | 200  |
F03    | 300  | 200  | 150  | 100  |
W01    | 30   | 50   | 100  | ...  |
```

#### 4. 约束参数 (Constraint Configuration)

```
[约束配置]
约束类型        | 设置
覆盖范围        | 每个客户必须被服务
交付时间        | 强制约束/软约束
产能限制        | 是/否
多供应源        | 最多/最少供应商数
库存约束        | 安全库存系数 z = 1.645 (对应95%完成率)
```

#### 5. 优化配置 (Optimization Configuration)

```
[优化设置]
目标             | 成本最小化
权重配置：
  - 固定成本    | 1.0
  - 运输成本    | 1.0
  - 库存成本    | 1.0
  
求解器设置：
  - 方法        | 自动 (或手动选择: 精确/启发式)
  - 时间限制    | 10分钟
  - 最优性gap   | 5% (精确求解不会超过这个gap)
  
场景分析：
  - 基准场景：当前网络配置成本
  - 优化场景：OMP的推荐方案
  - 敏感性分析：需求±20%的影响
```

### 典型实施流程中的Network Design应用

#### 阶段1：Discovery (第1-2月)

**目的：** 收集数据，定义优化范围

**Network Design相关工作：**
- 确认设施清单 (工厂、仓库、配送中心的位置、产能)
- 确认需求分布 (客户地点、需求量、服务要求)
- 计算流动成本 (运输距离、运输方式、成本)
- 梳理约束 (产能、交付时间、覆盖范围)

#### 阶段2：模型建立 (第3-4月)

**目的：** 在OMP中建立Network Design模型

**关键活动：**
- 在OMP中创建设施主数据
- 配置产能和成本参数
- 定义流动关系 (哪些设施可以服务哪些客户)
- 设置约束条件
- 配置目标函数权重

#### 阶段3：优化运行 (第5-6月)

**目的：** 生成优化建议

**流程：**
```
输入: 当前网络配置 + 参数
      ↓
    OMP优化引擎
      ↓
输出: 最优网络方案
      - 推荐开放哪些设施
      - 推荐关闭哪些设施
      - 产品流向建议
      - 库存配置建议
      - 预期成本节省
```

#### 阶段4：敏感性分析 (第7月)

**目的：** 验证方案的鲁棒性

**分析场景：**
- 需求增长 (+20%)：方案是否仍然适用？
- 需求下降 (-20%)：是否需要调整？
- 新品推出：原方案能容纳吗？
- 某个设施故障：备选方案是什么？

#### 阶段5：实施规划 (第8-10月)

**目的：** 设计实施路径

**Network Design的输出被用于：**
- 成本效益分析 (投资vs节省)
- 时间表规划 (何时关闭设施、何时扩建)
- 风险评估 (实施风险、市场风险)
- 人员安置计划 (受影响员工)

---

## 面试准备

### 面试场景 1: 业务问题导向

**面试官提问：**
> "假设你负责一个大型电子制造企业的供应链优化项目。
> 企业有5个生产工厂、10个仓库、200个经销商。
> 现在需要用OMP优化整个网络。
> 你会怎么设计这个Network Design模型？"

**答题框架：**

1. **确认理解问题** (30秒)
```
"让我确认一下问题的关键点：
- 企业有三层网络（工厂、仓库、经销商）
- 目标是优化这个网络的成本/服务
- 要用OMP的Network Design模块
是这样吗？"
```

2. **分析问题维度** (2分钟)
```
"首先，我会分析这个问题的几个关键维度：

1. 网络结构：
   - 工厂：生产节点，有产能限制
   - 仓库：中转节点，有容量限制，产生库存
   - 经销商：需求节点，有服务要求
   
2. 决策变量：
   - 工厂：是否开放、产能分配
   - 仓库：是否保留、如何分工
   - 流向：哪些工厂供应给哪些仓库、
           哪些仓库供应给哪些经销商
   - 库存：各仓库的库存水平

3. 目标函数：
   - 成本最小化：固定成本（设施）+ 运输成本 + 库存成本
   - 约束平衡：需要满足交付时间、完成率等

4. 关键约束：
   - 产能约束（工厂产能，仓库容量）
   - 流量平衡（仓库是中转，流入=流出）
   - 需求满足（所有经销商需求必须被满足）
   - 交付时间（假设经销商要求3-5天内交付）
   - 供应链连通性（工厂关闭，则无法供应）"
```

3. **提出数据需求** (1.5分钟)
```
"为了在OMP中建立这个模型，我需要收集：

数据类型1 - 成本数据：
  - 每个工厂的固定成本（年度）
  - 每个仓库的维护成本
  - 工厂到仓库的运输单价（可能基于距离）
  - 仓库到经销商的运输单价
  - 库存持有成本（通常是存货价值的10-20%/年）

数据类型2 - 容量和需求：
  - 每个工厂的产能（件/月）
  - 每个仓库的存储容量（件）
  - 每个经销商的月需求量、地点
  - 产品的相关参数（是否有仓储限制、保质期等）

数据类型3 - 约束条件：
  - 交付时间要求（经销商到货的期限）
  - 完成率要求（是否允许缺货）
  - 产品-工厂兼容性（某些产品只能在某些工厂生产）
  - 地区覆盖（是否每个地区都要有备选供应源）"
```

4. **描述模型框架** (2分钟)
```
"在OMP中，我会建立多层Network Design模型：

模型名称：Multi-echelon Network Design

层级定义：
L1 = 5个工厂（生产节点）
L2 = 10个仓库（配送节点）
L3 = 200个经销商（需求节点）

决策变量：
y_j ∈ {0,1} : 工厂/仓库是否开放
x_ij : 从节点i到节点j的流量
I_k : 仓库k的库存水平

目标函数：
最小化 Z = 
  Σ (工厂固定成本 × y_j) +
  Σ (仓库固定成本 × y_k) +
  Σ (工厂→仓库运输成本 × x_ij) +
  Σ (仓库→经销商运输成本 × x_kl) +
  Σ (库存持有成本 × I_k)

约束：
1. 产能约束：工厂产出 ≤ 工厂产能
2. 容量约束：仓库库存 ≤ 仓库容量
3. 流量平衡：仓库流入 = 仓库流出 + 库存增加
4. 需求满足：Σ(供应量) ≥ 需求量
5. 交付时间：工厂→经销商时间 ≤ 目标时间
6. 供应链连通：若工厂关闭，则无法向其他层供应"
```

5. **说明求解方法** (1.5分钟)
```
"这个模型的规模：
- 决策变量：~5×10 + 10×200 + 200 = ~2300个
- 约束：~500-1000个
- 二进制变量：~15个

求解方法：
- 不能用精确算法（太大）
- OMP会使用启发式+分支定界的混合方法
- 通常在10-30分钟内得到80-90%最优的方案

实施步骤：
1. 在OMP中输入上述数据和参数
2. 设置优化目标（成本最小化 vs 服务最优）
3. 运行优化
4. 进行敏感性分析（需求变化、成本变化）
5. 与客户讨论方案的可行性
6. 生成实施路径"
```

6. **提出关键假设** (1分钟)
```
"实施中的关键假设：
- 假设运输成本与距离成正比
- 假设库存成本不考虑产品的价值差异（简化）
- 假设交付时间主要由运输决定
- 假设产能固定（暂不考虑产能扩建的投资）

这些假设可以在后续敏感性分析中验证和调整。"
```

---

### 面试场景 2: 技术问题导向

**面试官提问：**
> "Network Design模型中，为什么库存成本这么重要？
> 如何在模型中正确地表示库存成本？
> 它与固定成本的关系是什么？"

**答题框架：**

1. **库存成本为什么重要** (2分钟)
```
"在供应链中，库存成本往往比固定成本和运输成本都要大。
原因包括：

1. 数值规模：
   - 库存成本 = 库存量 × 单位持有成本
   - 在多仓库系统中，库存是分散的
   - 总库存往往很高

2. 行业差异：
   电子产品（如vivo的PCBA）：
   - 库存成本比例：40%+ （器件贬值快）
   - 是整个供应链成本的主导
   
   FMCG（快消品）：
   - 库存成本比例：20-30%
   - 与运输成本可比
   
   汽车零部件：
   - 库存成本比例：25-35%
   - 因为产品价值高，库存利息大

3. 与网络结构的关系：
   - 更多仓库 → 每个仓库的库存可以降低（可以等到需求更明确）
   - 但也可能导致库存分散（总库存反而增加）
   - 这就是Network Design要权衡的地方"
```

2. **库存成本的数学表示** (2.5分钟)
```
"库存成本由几个部分组成：

1. 周期库存成本 (Cycle Stock Cost)：
   定义：为满足平均需求而持有的库存
   公式：
   Cycle_I_j = (D_j / 2) × h_j
   
   其中：
   - D_j = 仓库j的总需求（件/周期）
   - h_j = 单位库存持有成本（元/件/周期）
   - 假设库存线性下降，平均 = D_j/2

2. 安全库存成本 (Safety Stock Cost)：
   定义：对付需求波动的额外库存
   公式：
   SS_j = z × σ_j × √L_j
   
   其中：
   - z = 安全因子（由目标完成率决定）
     z=1.645 for 95%, z=2.326 for 99%
   - σ_j = 仓库j处的需求标准差
   - L_j = 交付周期（从上游补充）
   
   安全库存成本 = SS_j × h_j

3. 总库存成本：
   I_j = (Cycle_I_j + SS_j) × h_j
   
   整个网络：
   Z_inventory = Σ_j h_j × I_j

在OMP中的简化表示：
Z_inventory = Σ_k h_k × I_k
其中 I_k 是决策变量，由流量和交付周期决定"
```

3. **库存与网络结构的权衡** (2分钟)
```
"库存与设施数量的经典权衡：

情景1：集中网络（1个大仓库）
  - 固定成本：低（只有1个仓库）
  - 库存成本：高（需要大量安全库存应对全国需求波动）
  - 总成本 = 固定 + 运输 + 库存 = 中等-高

情景2：分散网络（10个区域仓库）
  - 固定成本：高（10个仓库的费用）
  - 库存成本：低（每个仓库只应对区域需求，波动小）
  - 总成本 = 固定 + 运输 + 库存 = 中等-低

安全库存的关键公式说明：
SS = z × σ × √L

- 若交付周期L短，则SS小
- 分散网络 → 每个节点的L短 → SS小 → 库存总成本低
- 但增加了固定成本

这就是为什么在电子制造行业，往往需要多个仓库，
虽然增加了固定成本，但通过降低库存成本反而降低了总成本。"
```

4. **在优化中的应用** (1.5分钟)
```
"在Network Design优化中，库存成本的处理：

1. 参数设置：
   h_k = 某个仓库的库存持有成本
   通常是年度库存价值的10-25%
   对于高科技产品（器件贬值快），可能是20-30%

2. 库存量计算：
   在OMP中，可以有几种方式：
   
   方式A：固定系数法
   I_k = α × (仓库的流入量)
   其中 α 是库存周期系数（如0.5表示平均库存是月流量的50%）
   
   方式B：公式法
   I_k = (D_k/2) + z×σ_k×√L_k
   其中首项是周期库存，第二项是安全库存
   
   方式C：约束法
   I_k ≥ z×σ_k×√L_k（库存不能低于安全库存）
   I_k ≤ Cap_k（库存不能超过仓库容量）

3. 优化结果的影响：
   - 若库存成本权重低，方案可能选择集中网络
   - 若库存成本权重高，方案倾向于分散网络
   - 需要根据实际行业特点调整权重"
```

---

### 面试场景 3: vivo具体应用

**面试官提问：**
> "在你vivo的PCBA项目中，如果要用Network Design来优化
> 深圳、成都、西安三个工厂和下游仓库的配置，
> 你会设定什么样的模型？有哪些特殊考虑？"

**答题框架：**

1. **vivo PCBA的特殊性** (1.5分钟)
```
"vivo PCBA制造有几个特殊的特点，会影响Network Design模型：

1. 产品特性：
   - 电子产品，器件贬值快（每月5-10%贬值）
   - 库存成本非常高（h_k = 20-30% per年）
   - 这意味着库存是成本中的大头
   
2. 工厂特性：
   - 三个工厂成本差异大：深圳>成都>西安
   - 但深圳靠近港口（利于出口）
   - 成都和西安相对内陆，但劳动力成本低
   
3. 产品特性：
   - 新品和老品的混合：
     新品：高价值、快更新，需要加急配送（深圳优势）
     老品：低价值、相对稳定，可以从成本工厂生产
   
4. 市场特性：
   - 主要销售在中国，但也出口
   - 需求波动随季节和产品发布周期变化
   - 某些渠道需要快速交付（3天内）"
```

2. **模型设计** (3分钟)
```
"基于vivo的特点，我会设计如下模型：

网络结构：
L1 = 原材料供应商（暂不优化，固定）
L2 = 3个PCBA工厂（深圳、成都、西安）
L3 = 若干区域仓库（假设5个：华东、华南、华北、华中、西部）
L4 = 销售渠道（线上、零售、OEM等）

决策变量：
1. 工厂层面：
   y_j ∈ {0,1} : 工厂j是否开放
   （虽然现在三个都开放，但优化可能建议某个缩小）

2. 产品分工：
   x_{jp} : 工厂j是否生产产品p
   （新品和老品的分工）
   
3. 流向：
   x_{jk} : 从工厂j到仓库k的流量
   x_{kl} : 从仓库k到销售渠道l的流量
   
4. 库存：
   I_k : 仓库k的库存水平
   
成本参数：
1. 工厂成本（年）：
   深圳：f_1 = 5000万（固定费用，高）
   成都：f_2 = 3000万（中等）
   西安：f_3 = 2000万（最低，但交付远）
   
2. 生产成本（运营）：
   深圳：c_1 = 100元/件（最高，但接近港口）
   成都：c_2 = 70元/件
   西安：c_3 = 50元/件（最低）

3. 库存持有成本：
   h_k = 25% per年（器件贬值快！）
   
4. 运输成本：
   工厂→仓库：基于距离（深圳出发最远）
   仓库→客户：基于距离和渠道
   
5. 特殊成本：
   加急运费（新品发布期间）
   长距离运输（西安→东部的费用很高）

约束条件：
1. 产能约束：
   三个工厂的月产能：
   深圳：1000K件
   成都：800K件
   西安：500K件
   （不够灵活调整）
   
2. 产品分工约束：
   新品（高端A系列）：必须从深圳或成都（品质好）
   老品（低端B系列）：可以从西安（成本低）
   
3. 交付时间约束：
   华东渠道：必须2天内（需要华东仓库）
   华南渠道：2-3天内（可选华南仓库）
   内陆渠道：3-5天（较灵活）
   
4. 库存约束（关键）：
   安全库存 SS_k = z × σ_k × √L_k
   z = 1.645 (95%完成率)
   σ_k 按工厂到仓库的距离估计
   L_k 考虑产品生命周期的不确定性
   
5. 可用性约束：
   仓库k的存储容量有限（通常3-6周的需求）

目标函数：
Minimize Z = 
  Σ(工厂固定成本 × y_j) +
  Σ(工厂运营成本 × 产量) +
  Σ(厂→库运输成本) +
  Σ(库→客运输成本) +
  25% × Σ(仓库库存 × 库存成本) +  ← 这项很大！
  加急费用
  
权重调整（相对于其他行业）：
- 库存权重：1.0（很高）
- 固定成本权重：0.8（中等）
- 运输权重：0.8（中等，但不如库存重）"
```

3. **优化结果的预期** (2分钟)
```
"基于上述模型，我预计的优化结果：

可能的方案1（保守型）：
- 保留三个工厂
- 新品（A系列）：深圳+成都分担（品质和成本平衡）
- 老品（B系列）：转向成都和西安（成本优先）
- 成本节省：5-8%（主要来自生产成本和库存优化）

可能的方案2（激进型）：
- 考虑缩小西安工厂（利用率不足）
- 产能向成都集中（成本和交付平衡）
- 新品：深圳独占（品质保证）
- 老品：全部成都（成本最优）
- 成本节省：10-15%（但有实施风险）

可能的方案3（服务优先）：
- 保留或扩大华东仓库（支持2日达）
- 增加安全库存（满足加急订单）
- 成本增加：5-8%（但满足高端渠道要求）

关键敏感性分析：
1. 新品比例变化（±10%）：
   - 影响深圳的产量
   - 可能改变工厂的最优配置

2. 交付时间要求变化：
   - 若要求全国2日达，需要更多仓库，成本大幅增加
   - 若放宽到3日达，可以减少仓库，成本下降

3. 库存成本变化：
   - 若器件贬值加速（库存成本↑30%），
     方案会倾向更多的分散网络以降低库存
   - 这是成本快速变化的行业的特点"
```

4. **实施建议** (1分钟)
```
"实施这个Network Design的建议：

1. 数据准备（最关键）：
   - 收集最近12个月的成本数据
   - 分析每个工厂的实际生产成本（包括不良率、人工、能源）
   - 计算库存持有成本（考虑贬值、保管费、资金利息）
   - 梳理产品的技术要求和产能兼容性

2. 逐步优化：
   - 第1阶段：验证当前网络的成本基线
   - 第2阶段：优化产品分工（新品vs老品）
   - 第3阶段：优化库存配置
   - 第4阶段：考虑工厂产能调整（长期）

3. 变更管理：
   - 与生产部门沟通（产品转移、交付影响）
   - 与销售沟通（交付时间可能改变）
   - 与财务沟通（投资评估）"
```

---

### 常见追问与回答

**Q1: "如果两个工厂的成本差异很小，模型怎么选择？"**

A: "如果成本接近，模型会利用运输距离和交付时间来区分。同时，会加入多供应源的考虑来降低风险。这时候敏感性分析很重要——看成本变化±5%时，最优决策是否改变。"

**Q2: "库存的安全因子z怎么确定？"**

A: "z由目标完成率（或目标缺货率）决定。例如：
- 95%完成率 → z = 1.645
- 99%完成率 → z = 2.326
这是反向查标准正态分布表得到的。不同SKU可能有不同的z值。"

**Q3: "模型中怎么考虑产品生命周期？"**

A: "可以用几种方式：
1. 分产品线优化（新品和老品分别建模）
2. 动态模型（按时期，新品逐步变成老品）
3. 参数调整（新品用更高的运输费率以支持快速配送）
实际中，方法1最常用。"

**Q4: "如果优化方案关闭某个工厂，现实中有什么难度？"**

A: "这是实施中最大的难度：
- 员工安置（关闭可能涉及大量离职赔偿）
- 固定资产处理（工厂、设备的处置）
- 供应链风险（单一工厂故障风险增加）
- 时间成本（转移产能、培训需要时间）
所以实际实施中，往往不是关闭，而是缩小或转向轻资产模式。"

---

## 总结

### Network Design理论的核心要点

1. **问题本质：** 在固定成本、运输成本、库存成本之间找最优权衡

2. **模型演进路径：**
   ```
   UFLP (单设施) 
   → CFLP (加产能) 
   → 两层MEND (加仓库) 
   → 多层MEND (完整链条)
   → 动态ND (考虑时间和投资)
   ```

3. **求解现实：**
   - 小规模（<50设施）→ 精确算法
   - 中等规模（50-200）→ 启发式+精确混合
   - 大规模（>200）→ 只能启发式

4. **OMP中的体现：**
   - OMP不需要用户编程模型
   - 而是通过参数配置来"建模"
   - 后端的优化引擎自动处理求解

5. **实施重点：**
   - 70%的时间在数据收集和整理
   - 20%的时间在模型配置和验证
   - 10%的时间在优化运行

### 面试中的致胜点

1. **深度理解模型** 不只是公式，而是理解模型背后的成本权衡
2. **与业务结合** 能用行业背景说明为什么要这样建模
3. **承认局限性** "这个假设在实际中可能不成立，需要敏感性分析来验证"
4. **考虑实施难度** 最优方案不一定是最可行的方案
5. **数据导向思维** "在建模前，先确保数据的准确性"

---

**祝你面试顺利！**

这份文档涵盖了从基础模型到复杂变体的完整理论体系，应该足以应对OMP实施顾问的技术面试。关键是理解模型背后的业务逻辑，而不只是公式本身。
